# chap4 에지와 영역

#### 에지 
물체 경계에 위치한 점 
- 에지 검출 : 에지에 해당 화소 찾기
- 에지 향상 : 에지 더 잘보이도록 하기 위해 에지와 배경 간의 대비 증가
- 에지 추적 : 에지 따라가기

- 에지를 완벽하게 검출해 물체의 경계를 폐곡선으로 따낼 수 있다면 분할 문제 해결
- 특성이 크게 다른 화소에 집중하는 방식

-> 물체의 위치 모양 크기 에 대한 정보 찾기 가능

#### 영역
특성이 비슷한 화소를 묶는 방식


에지 검출 알고리즘 : 물체 내부는 명암이 서서히 변하고 경계는 급격히 변하는 특성 활용

### 4.1.1 영상의 미분
미분 : 변수의 x 값이 미세하게 증가했을 때 함수 변화량 측정, 에지 추출 방법

* 영상을 (x, y) 변수의 함수로 간주했을 때, 이 함수의 1차 미분(1st derivative) 값이 크게 나타나는 부분을 검출

디지털 영상 미분
- 미분은 기본적으로 연속적인 공간에서 적용, but 영상은 연속공간이 아닌 이산 공간이기에 근사화한 것으로 적용
- 영상 f에 미분 적용해 f' -> 영상에서 가장 작은 단위가 1이며 (-1,1)로 컨볼루션
- 필터 u(에지 연산자)로 컨볼루션하여 구현
- 명암을 미분해 튀어나온 부분이 에지

### 4.1.2 에지 연산자
- 명암 변화 x = 0
- 명암 변화 o = 3 
- 에지 검출은 모두 명암 변화에만 의존, 두 인접한 물체가 비슷한 명암을 가져 명암 변화가 적은 경우 경계에서 에지 발생X

컨볼루션의 값은 f 원래 영상의 부호를 의미한다 !?

물체 경계를 지나면서 명암값이 커지면 미분값 양수, 작아지면 음수


램프에지 : 계단 모양이 아닌, 명암이 몇화소에 걸쳐 변화, 정확한 에지의 위치 찾기 어려움

---- 에지 검출 과정 --- 
두꺼운 에지에서 위치 찾기 적용

1차미분 : 원래 영상의 변화량이 1차 미분값 
에지 발생여부와 에지가 어떤 방향을 향하는지 알 수 있음
봉우리 찾기

2차미분 : 1차 미분값의 변화량이 2차 미분값
영교차 찾기 

![image](https://user-images.githubusercontent.com/109460178/227122703-6325016c-3126-446e-86b0-d14d2499b2ee.png)
-	봉우리 : 봉우리의  두께가 1이므로 계단 에지만 존재하는 경우 에지 찾기 간단
-	영교차 : 왼쪽과 오른쪽에 부호가 다른 반응 발생, 자신은 0을 갖는 위치

#### 1차 미분에 기반한 에지 연산자
미분에 기반한 2차원 에지 연산자는 크기 확장시 잡음을 흠수해 더 좋은 성능 보임
-> 잡음으로 인해 스무딩이 필요해 2차원 연산저 적용

- 프로윗 
   장점 : 돌출된 값을 잘 평균화
   단점 : 값이 일렬로 나열되어 있어 대각선보다 수평 수직에 놓인 에지에 민감

- 소벨 
    장점: 돌출된 값 잘 평균화, 모든 방향 에지 검출 가능, 잡음에 강함
    단점 : 대각선 방향에 놓인 에지 민감
    
실제영상에서 구한 그래디언트 크기와 방향은 프레윗과 소벨을 적용한 결과 영상
- 에지 강도 : 크기 = 픽셀 값의 차이 정도, 변화량 -> 에지 가능성 나타냄
- 에지 방향 : 방향 = 값이 급격히 증가하는 방향 -> 에지 진행 방향 나타냄

![image](https://user-images.githubusercontent.com/109460178/227124583-f145bb2f-f6e8-4783-9ab3-9f3d2f055de9.png)

각각 프로윗 소벨 적용한 값을 기반으로 에지 방향 구함


## 4.2 캐니 에지
1. 블러링 통한 노이즈 제거 : 5*5 크기의 가우시안 필터 적용해 불필요 잠음 제거
2. 그래디언트 계산 : 기울기의 크기와 방향 계산
**3. 비최대치 억제**   
현재 화소가 이웃하는 화소들보다 크면 보존, 그렇지 않으면 에지가 아닌 것으로 간주 == 최대가 아니면 억제   
에지 방향에 수직인 두 이웃 화소의 에지 강도 비교

**4. 이력 임계값으로 에지 결정**   
실제 에지가 아닌데 에지로 검출된 화소인 거짓 긍정을 줄이기 위해 임계값 사용   
두개의 임계값 T(high), T(low)를 사용해서 에지의 이력을 추적하여 에지를 결정하는 방법  
![image](https://user-images.githubusercontent.com/109460178/227133915-5b6112c4-c68b-4029-bb13-bbbd3dd99b45.png)

- 에지 추적은 T_high를 넘는 화소에서 시작, 추적 도중에는 T_low 적용 
- 이웃 화소가 추적이력이 있으면 자신은 신뢰도가 낮더라도 에지로 간주
- 추적 시작하지 않은 이웃 화소들을 대상으로  T(low)보디 큰 화소 에지 결정



## 4.3 직선 검출
에지 화소는 1, 에지가 아닌 화소 0  
**에지를 연결해 경계선으로 변환하고 경계선을 직선으로 변환 -> 물체 표현이나 인식에 유리**  

1) 에지 맵에서 경계선 검출 2) 길이가 임계값 이상인 경계선만 취함

##### findCountours 사용
- 경계선 찾을 에지 영상
- 구멍이 있는 경우 바깥쪽 경계선과 그 안에 구멍의 경계선을 계층적으로 찾는 방식 지정
  -> cv.RETR_LIST : 맨 바깥쪽 경계선 찾기
- 경계선 표현 방식 지정
   -> cv.CHAIN_APPROX_NONE : 모든 점 기록 / cv.CHAIN_APPROX_SIMPLE : 직선에 대해 양 끝점만 기록 / cv.CHAIN_APPROX_TC89_L1 & cv.CHAIN_APPROX_TC89_KCOS : Teh-Chin 알고리즘으로 굴곡이 심한 점 찾아 기록
   
   • contours: 검출된 외곽선 좌표
   • hierarchy: 외곽선 계층 정보     
   
##### drawCountours 사용
왔다갔다 반복되는 부분이 있어서, 50이상의 경계선을 검출하고 싶다면 한계 100
-> 함수는 시작점부터 끝점까지 추적한 다음 역추적하여 시작점으로 돌아와 경계선 표현하기 때문
- 경계선 그려넣을 영상
- 경계선
- 모든 경계선 그리기 (-1), 해당 번호에 해당하는 경계선 하나만 그리기 (양수)
- 색
- 두께


잡음 발생 : 에지가 자잘하게 끊겨 나타나는 경우 발생 -> **"허프변환"** 적용하면 끊긴 에지 모아 선분 or 원 등 검출





