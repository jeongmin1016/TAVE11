# chap10 동적비전

## 10.1 모션 분석
물체의 모션 정보를 분석하는 알고리즘     
</br>   
비디오 video : 시간 순서에 따라 정지 영상을 나열한 구조
- 동영상 dynamic image 라고도 부름
- 프레임 frame : 비디오를 구성하는 영상 한 장, 2차원 공간에 정의
- 프레임 + 시간 축을 3차원 시공간 형성
- 컬러 영상의 프레임 m x n x 3 구조 텐서, T장의 프레임을 담은 비디오는 m x n x 3 x T의 4차원 구조 텐

![image](https://user-images.githubusercontent.com/109460178/230826555-a15d9048-c47f-4a54-b076-2f9a408fafec.png)

딥러닝 이전엔, 배경이 고정된 상황에서는 **"차영상"** 을 분석해 정보 획득
- t 순간 프레임의 (j,i) 화솟값
- d(j,i,t) = |f(j,i,0)-f(j,i,t)|, 0<=j<m, 0<=i<n, 1<=t<=T

### 모션 벡터와 광류
<목표> 움직이는 물체는 연속 프레임에 명암 변화를 발생하니, 이를 분석해 역으로 물체의 모션 정보 확인     
</br>   
광류 optical flow : 화소별로 모션벡터 motion vector를 추정해 기록한 맵     
== 이전 프레임과 현재 프레임의 차이를 이용하고 픽셀값과 픽셀과의 관계를 통해 각 픽셀의 이동motion을 계산해 추출 

![image](https://user-images.githubusercontent.com/109460178/230829666-2ef6ce34-2e00-46bb-948b-df0fa05be354.png)

출처 : https://gaussian37.github.io/vision-concept-optical_flow/

모션벡터를 추정하는 알고리즘은 물체가 이동, 회전, 크기변환을 하며, 환경이 조명변화와 잡음을 복합적으로 발생시켜 화소가 다음 순간에 어디로 이동했는지 확정하기는 어려움        
=>    
해결 방안으로 연속한 두 영상에서 같은 물체는 같은 명암으로 나타난다는 **밝기 향상성 brightness constancy** 조건 가정     
<br>
시간 간격이 짧다면 테일러 근사로 전개 -> 광류조건식 optical flow constrait equation 생성

![image](https://user-images.githubusercontent.com/109460178/230828050-20fdccc1-9f01-43b2-be85-932c4a7a70cb.png)

+ 각각 v,u는 dt동안 y,x방향으로 이동한 양으로 모션벡터에 해당
+ df/dy. df/dx는 각각 y,x방향의 명암 변화로서 에지검출에 사용한 에지연산자 사용
+ (영상의 y축 변화) x v + (영상의 x축 변화) x u + 영상의 t축 변화 = 0
+ 식은 하나지만 변수는 두개이므로 유일한 해를 확정할 수는 없지만 **이웃 화소 관계를 고려**하면 정확한 해 도출 가능

1. Lukas-Kanade 알고리즘   
  어떤 화소는 이웃 화소와 유일한 모션 벡터를 갖는다는 지역조건 사용    
  - 장점 | 연산량 적음  
  - 단점 | 정확도 낮음

![image](https://user-images.githubusercontent.com/109460178/230831582-fe7a564a-c7a4-4af6-a417-75fd5d38e3b2.png)

  1) 밝기향상성
  2) frame 간 움직임 적음 
  3) 픽셀 (y,x)를 중심으로 하는 윈도우 영역 N(y,x)의 optical flow 동일
   
![image](https://user-images.githubusercontent.com/109460178/230830533-6f5e25b4-1961-4f08-998d-0d57879caedc.png)

 
2. Horn-Schun 알고리즘           
  영상 전체에 걸쳐 서서히 변해야 한다는 광역조건 사용   
  - 장점 | 정확도 높음  
  - 단점 | 모든 픽셀을 계산하기에 속도 느림
  
  1) 밝기향상성
  2) frame 간 움직임 적음 
  3) optical flow 균일
  
  ![image](https://user-images.githubusercontent.com/109460178/230830562-a637a7ce-06cc-4a6d-997b-4414af0c0102.png)

3. Farneback 알고리즘              
  인접한 두 프레임 간의 움직임을 확장 다항식 기반으로 계산하는 dense optical flow의 한 종류
  - 장점 | 정확도 높음  
  - 단점 | 계산 과정이 복잡해 시간 오래 걸림
</br>
  `cv.calcOpticalFlowFarneback(	prev, next, flow, pyr_scale, levels, winsize, iterations, poly_n, poly_sigma, flags	) `
  - input 배열 이전 영상      
  - input 배열 현재 영상     
  - 출력 계산된 옵티컬 플로우     
  - 축소 비율      
  - 영상 개수      
  - 윈도우 크기     
  - 각 영상개수(levels)에서 알고리즘 반복 횟수              
  - 다항식 확장을 위한 이웃 픽셀 크기            
  - 가우시안 표준편차                
  -  0, cv2.OPTFLOW_USE_INITIAL_FLOW, cv2.OPTFLOW_FARNEBACK_GAUSSIAN.                      
 
4. 희소 광류 추정을 이용한 KT 추척 알고리즘













### 딥러닝 기반 광류 추정



















## 10.2 추적
물체를 실시간으로 추적하는 알고리즘




## 10.3 MediaPipe를 이용해 비디오에서 사람 인식
비디오에 나타난 사람을 인식하는 여러 방법 설명



## 10.4 자세 추정과 행동 분류
라이브러리로 얼굴과 손을 검출하고 사람의 자세를 추정하는 프로그래밍 실습
